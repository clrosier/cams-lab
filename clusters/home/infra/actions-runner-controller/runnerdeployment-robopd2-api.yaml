---
apiVersion: actions.summerwind.dev/v1alpha1
kind: RunnerDeployment
metadata:
  name: robopd2-api-runner
  namespace: actions-runner-system
spec:
  replicas: 1
  template:
    spec:
      # Repository-level runner for robopd2-api
      repository: cameronrosier/robopd2-api
      # Labels to identify this runner in GitHub Actions workflows
      labels:
        - self-hosted
        - robopd2
      # Docker image for the runner (supports ARM64 for Raspberry Pi)
      image: summerwind/actions-runner:latest
      # Resource constraints for Raspberry Pi
      resources:
        requests:
          cpu: 500m
          memory: 1Gi
        limits:
          cpu: 2000m
          memory: 4Gi
      # Security context for buildah (needs to run as root with capabilities)
      # Note: buildah requires privileged access or specific capabilities to work properly
      securityContext:
        privileged: true
      # Volume mounts for buildah storage
      volumeMounts:
      - mountPath: /var/lib/containers
        name: buildah-storage
      volumes:
      - name: buildah-storage
        emptyDir: {}
      # Node selector to prefer worker nodes (avoid control-plane)
      # nodeSelector:
      #   node-role.kubernetes.io/control-plane: "false"

