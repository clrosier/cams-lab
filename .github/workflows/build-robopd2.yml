name: Build RoboPD2

on:
  push:
    branches: [main]
    paths:
      - 'clusters/home/apps/robopd2/**'
      - '.github/workflows/build-robopd2.yml'
  pull_request:
    branches: [main]
    paths:
      - 'clusters/home/apps/robopd2/**'
      - '.github/workflows/build-robopd2.yml'
  workflow_dispatch:

jobs:
  build-api:
    name: Build FastAPI Backend
    runs-on: [self-hosted, robopd2]
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3
      
      - name: Build API image
        run: |
          # TODO: Update with your actual build command and registry
          docker build -t robopd2-api:latest ./api
          echo "API image built successfully"
      
      - name: Push API image (optional)
        if: github.event_name == 'push' && github.ref == 'refs/heads/main'
        run: |
          # TODO: Add your registry push commands here
          # docker tag robopd2-api:latest your-registry/robopd2-api:${{ github.sha }}
          # docker push your-registry/robopd2-api:${{ github.sha }}
          echo "Push to registry (configure registry credentials first)"

  build-web:
    name: Build Vue Frontend
    runs-on: [self-hosted, robopd2]
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3
      
      - name: Build Web image
        run: |
          # TODO: Update with your actual build command and registry
          docker build -t robopd2-web:latest ./web
          echo "Web image built successfully"
      
      - name: Push Web image (optional)
        if: github.event_name == 'push' && github.ref == 'refs/heads/main'
        run: |
          # TODO: Add your registry push commands here
          # docker tag robopd2-web:latest your-registry/robopd2-web:${{ github.sha }}
          # docker push your-registry/robopd2-web:${{ github.sha }}
          echo "Push to registry (configure registry credentials first)"

